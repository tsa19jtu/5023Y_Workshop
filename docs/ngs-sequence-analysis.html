<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 NGS sequence analysis | Introduction to Bioinformatics - 5023Y</title>
  <meta name="description" content="This is very brief introduction to some of the basic skills required to handling sequencing data for Bioinformatics - with one reproducible example analysing microbiome sequencing data" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 NGS sequence analysis | Introduction to Bioinformatics - 5023Y" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is very brief introduction to some of the basic skills required to handling sequencing data for Bioinformatics - with one reproducible example analysing microbiome sequencing data" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 NGS sequence analysis | Introduction to Bioinformatics - 5023Y" />
  
  <meta name="twitter:description" content="This is very brief introduction to some of the basic skills required to handling sequencing data for Bioinformatics - with one reproducible example analysing microbiome sequencing data" />
  

<meta name="author" content="Philip Leftwich" />


<meta name="date" content="2021-08-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Unix.html"/>
<link rel="next" href="introduction-to-statistical-analysis-of-the-microbiome-data.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="Unix.html"><a href="Unix.html"><i class="fa fa-check"></i><b>2</b> Unix</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Unix.html"><a href="Unix.html#what-is-unixlinux"><i class="fa fa-check"></i><b>2.1</b> What is Unix/Linux?</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="Unix.html"><a href="Unix.html#some-terms"><i class="fa fa-check"></i><b>2.1.1</b> Some terms</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="Unix.html"><a href="Unix.html#why-learn-unix"><i class="fa fa-check"></i><b>2.2</b> Why Learn Unix?</a></li>
<li class="chapter" data-level="2.3" data-path="Unix.html"><a href="Unix.html#getting-started"><i class="fa fa-check"></i><b>2.3</b> Getting started</a></li>
<li class="chapter" data-level="2.4" data-path="Unix.html"><a href="Unix.html#a-few-foundational-rules"><i class="fa fa-check"></i><b>2.4</b> A few foundational rules</a></li>
<li class="chapter" data-level="2.5" data-path="Unix.html"><a href="Unix.html#lets-get-started"><i class="fa fa-check"></i><b>2.5</b> Let’s get started</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="Unix.html"><a href="Unix.html#downloading-data"><i class="fa fa-check"></i><b>2.5.1</b> Downloading data</a></li>
<li class="chapter" data-level="2.5.2" data-path="Unix.html"><a href="Unix.html#more-functions"><i class="fa fa-check"></i><b>2.5.2</b> More functions</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="Unix.html"><a href="Unix.html#unix-file-structure"><i class="fa fa-check"></i><b>2.6</b> Unix File Structure</a></li>
<li class="chapter" data-level="2.7" data-path="Unix.html"><a href="Unix.html#absolute-vs-relative-file-paths"><i class="fa fa-check"></i><b>2.7</b> Absolute vs relative file paths</a></li>
<li class="chapter" data-level="2.8" data-path="Unix.html"><a href="Unix.html#moving-around"><i class="fa fa-check"></i><b>2.8</b> Moving around</a></li>
<li class="chapter" data-level="2.9" data-path="Unix.html"><a href="Unix.html#summary"><i class="fa fa-check"></i><b>2.9</b> Summary</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="Unix.html"><a href="Unix.html#terms"><i class="fa fa-check"></i><b>2.9.1</b> Terms</a></li>
<li class="chapter" data-level="2.9.2" data-path="Unix.html"><a href="Unix.html#commands"><i class="fa fa-check"></i><b>2.9.2</b> Commands</a></li>
<li class="chapter" data-level="2.9.3" data-path="Unix.html"><a href="Unix.html#special-characters"><i class="fa fa-check"></i><b>2.9.3</b> Special characters</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="Unix.html"><a href="Unix.html#summary-1"><i class="fa fa-check"></i><b>2.10</b> Summary</a></li>
<li class="chapter" data-level="2.11" data-path="Unix.html"><a href="Unix.html#stretch-yourself---optional-extras-to-try-a-couple-of-other-skills"><i class="fa fa-check"></i><b>2.11</b> Stretch yourself - optional extras to try a couple of other skills</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="Unix.html"><a href="Unix.html#creation"><i class="fa fa-check"></i><b>2.11.1</b> Creation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html"><i class="fa fa-check"></i><b>3</b> NGS sequence analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#background-on-high-throughput-sequencing"><i class="fa fa-check"></i><b>3.1</b> Background on high throughput sequencing</a></li>
<li class="chapter" data-level="3.2" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#some-terms-1"><i class="fa fa-check"></i><b>3.2</b> Some terms</a></li>
<li class="chapter" data-level="3.3" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#the-data"><i class="fa fa-check"></i><b>3.3</b> The data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#fastq"><i class="fa fa-check"></i><b>3.3.1</b> FASTQ?</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#the-pipeline"><i class="fa fa-check"></i><b>3.4</b> The Pipeline</a></li>
<li class="chapter" data-level="3.5" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#removing-primers"><i class="fa fa-check"></i><b>3.5</b> Removing Primers</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#loops"><i class="fa fa-check"></i><b>3.5.1</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#dada2"><i class="fa fa-check"></i><b>3.6</b> DADA2</a></li>
<li class="chapter" data-level="3.7" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#quality-trimmingfiltering"><i class="fa fa-check"></i><b>3.7</b> Quality trimming/filtering</a></li>
<li class="chapter" data-level="3.8" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#dereplication"><i class="fa fa-check"></i><b>3.8</b> Dereplication</a></li>
<li class="chapter" data-level="3.9" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#asvs"><i class="fa fa-check"></i><b>3.9</b> ASV’s</a></li>
<li class="chapter" data-level="3.10" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#merging-reads"><i class="fa fa-check"></i><b>3.10</b> Merging reads</a></li>
<li class="chapter" data-level="3.11" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#count-table"><i class="fa fa-check"></i><b>3.11</b> Count table</a></li>
<li class="chapter" data-level="3.12" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#overview"><i class="fa fa-check"></i><b>3.12</b> Overview</a></li>
<li class="chapter" data-level="3.13" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#assign-taxonomy"><i class="fa fa-check"></i><b>3.13</b> Assign taxonomy</a></li>
<li class="chapter" data-level="3.14" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#standard-goods"><i class="fa fa-check"></i><b>3.14</b> Standard goods</a></li>
<li class="chapter" data-level="3.15" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#functions-list"><i class="fa fa-check"></i><b>3.15</b> Functions list</a></li>
<li class="chapter" data-level="3.16" data-path="ngs-sequence-analysis.html"><a href="ngs-sequence-analysis.html#summary-2"><i class="fa fa-check"></i><b>3.16</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html"><i class="fa fa-check"></i><b>4</b> Introduction to Statistical Analysis of the microbiome data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#important-files"><i class="fa fa-check"></i><b>4.1</b> Important files</a></li>
<li class="chapter" data-level="4.2" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#phyloseq"><i class="fa fa-check"></i><b>4.2</b> Phyloseq</a></li>
<li class="chapter" data-level="4.3" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#relative-abundance-of-bacteria-by-taxonomic-class"><i class="fa fa-check"></i><b>4.3</b> Relative abundance of bacteria by taxonomic Class</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#alpha-diversity---community-richness"><i class="fa fa-check"></i><b>4.4</b> Alpha diversity - community richness</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#analyse-and-plot"><i class="fa fa-check"></i><b>4.4.1</b> Analyse and plot</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#beta-diversity"><i class="fa fa-check"></i><b>4.5</b> Beta diversity</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#heatmaps"><i class="fa fa-check"></i><b>4.5.1</b> Heatmaps</a></li>
<li class="chapter" data-level="4.5.2" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#multidimensional-analysis"><i class="fa fa-check"></i><b>4.5.2</b> Multidimensional analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#question"><i class="fa fa-check"></i><b>4.6</b> Question</a></li>
<li class="chapter" data-level="4.7" data-path="introduction-to-statistical-analysis-of-the-microbiome-data.html"><a href="introduction-to-statistical-analysis-of-the-microbiome-data.html#summary-3"><i class="fa fa-check"></i><b>4.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a>
<ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Bioinformatics - 5023Y</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ngs-sequence-analysis" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> NGS sequence analysis</h1>
<script>
  addClassKlippyTo("pre.r, pre.bash");
  addKlippy('right', 'top', 'auto', '1', 'copy to clipboard', 'Copied!');
</script>
<div id="background-on-high-throughput-sequencing" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Background on high throughput sequencing</h2>
<p>High-throughput sequencing, also known as massively parallel sequencing or next-generation sequencing (NGS), is a collection of methods and technologies that can sequence DNA thousands/millions of fragments at a time. The market leader on NGS is Illumina, and an overview of their technology is in the video below.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/fCd6B5HRaZ8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<p>There are many uses for high throughput sequencing including:</p>
<ul>
<li><p>Whole genome sequencing</p></li>
<li><p>Amplicon sequencing - PCR of a targeted gene(s) is step one</p>
<ul>
<li>environmental DNA</li>
<li>16S Bacterial community analysis</li>
<li>Targeted gene panels</li>
</ul></li>
<li><p>RNA sequencing</p></li>
<li><p>ChIP sequencing: Protein-DNA interaction analysis</p></li>
</ul>
<p>Importantly a <strong>lot</strong> of the basic bioinformatics is the same across these technologies, because the data that is produced from the sequencing run is basically the same as well. The <em>big</em> data generated here are all massive <em>FASTQ</em> files, processing these follows basically the same initial pipeline for all applications.</p>
</div>
<div id="some-terms-1" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Some terms</h2>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;">
Term
</th>
<th style="text-align:left;font-weight: bold;">
What it is
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Insert
</td>
<td style="text-align:left;">
the DNA fragment that is being used for sequencing
</td>
</tr>
<tr>
<td style="text-align:left;">
Read
</td>
<td style="text-align:left;">
The part of the insert that is sequenced
</td>
</tr>
<tr>
<td style="text-align:left;">
Single read
</td>
<td style="text-align:left;">
A procedure in which the insert is sequenced once
</td>
</tr>
<tr>
<td style="text-align:left;">
Paired end
</td>
<td style="text-align:left;">
A procedure in which the insert is sequenced twice, once from each end
</td>
</tr>
<tr>
<td style="text-align:left;">
Flowcell
</td>
<td style="text-align:left;">
A small glass chip on which the DNA fragments are attached and then sequenced. The flowcell is covered in probes that allow hybridisation of DNA adpaters that were ligated onto the inserts
</td>
</tr>
<tr>
<td style="text-align:left;">
Lane
</td>
<td style="text-align:left;">
The flowcell has 8 physically separate lanes. Sequencing occurs in parallel on all lanes
</td>
</tr>
<tr>
<td style="text-align:left;">
Multiplexing/Demultiplexing
</td>
<td style="text-align:left;">
Sequencing multiple independent biological samples on the same lane is called multiplexing. After sequencing separating the data from from samples that were multiplexed is performed computationally and is called demultiplexing. This is done by a script that identifies unique sequences on the adapters that were attached to reads
</td>
</tr>
<tr>
<td style="text-align:left;">
Pipeline
</td>
<td style="text-align:left;">
The series of computational processes used to go from FASTQ data files to results and biological inferences
</td>
</tr>
</tbody>
</table>
</div>
<div id="the-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> The data</h2>
<p>This data comes from exploring an underwater mountain ~3 km down at the bottom of the Pacific Ocean that serves as a low-temperature (~5-10°C) hydrothermal venting site.</p>
<p>This amplicon dataset was generated from DNA extracted from crushed basalts collected from across the mountain with the goal being to begin characterizing the microbial communities of these deep-sea rocks. No one had ever been here before, so this was a broad-level community survey. The sequencing was done on the Illumina MiSeq platform with 2x300 paired-end sequencing using primers targeting the V4 region of the 16S rRNA gene.</p>
<p>There are 20 samples total: 4 extraction “blanks” (nothing added to DNA extraction kit), 2 bottom-water samples, 13 rocks, and one biofilm scraped off of a rock. None of these details are important for you to remember, it’s just to give some overview if you care.</p>
<details>
<summary>
<strong>Q. Why would we include “blank” samples in our sequencing run? - Click here for Answer</strong>
</summary>
<p><em>This sort of “environmental data” is very at risk of contamination, although the DNA extractions, and PCRs have to be run under sterile conditions or they will pick up bacteria from the lab and not the sample. Despite our best efforts we can still get minor contamination, these “blank” runs can be useful as anything in these samples</em> <strong>cannot</strong> <em>have come from our deep-sea rocks, and therefore we could choose to “remove” sequences that match these in our other samples and label them as contamination.</em></p>
</details>
<p>In the following figure, overlain on the map are the rock sample collection locations, and the panes on the right show examples of the 3 distinct types of rocks collected: 1) basalts with highly altered, thick outer rinds (&gt;1 cm); 2) basalts that were smooth, glassy, thin exteriors (~1-2 mm); and 3) one calcified carbonate.</p>
<div class="figure" style="text-align: center"><span id="fig:nice-fig"></span>
<img src="images/samples.png" alt="Map of collection sites and examples of the rocks collected" width="80%" />
<p class="caption">
Figure 3.1: Map of collection sites and examples of the rocks collected
</p>
</div>
<p>Altogether the uncompressed size of the working directory we are downloading here is ~300MB - this is about 10% of the full dataset - we are using a reduced dataset to minimise system requirements and speed up the workflow.</p>
<p>To get started, be sure you are in the “Terminal” window. We will be working here for the first step of importing the data, and removing the primers from our data. We can import our data using the <code>curl</code> function, we will then remove the primers using a program called <code>cutadapt</code> which is written in Python.</p>
<p>Make sure when you open the terminal you are in the project directory (and refer to last weeks notes if you need to check how to do this).</p>
<p>Don’t switch over to R (the “Console” tab in the Binder/RStudio environment) until noted. You can download the required dataset and files by copying and pasting the following commands into your command-line terminal:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="ngs-sequence-analysis.html#cb26-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-L</span> <span class="at">-o</span> dada2_amplicon_ex_workflow.tar.gz https://ndownloader.figshare.com/files/23066516</span>
<span id="cb26-2"><a href="ngs-sequence-analysis.html#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tar</span> <span class="at">-xzvf</span> dada2_amplicon_ex_workflow.tar.gz</span>
<span id="cb26-3"><a href="ngs-sequence-analysis.html#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> dada2_amplicon_ex_workflow.tar.gz</span>
<span id="cb26-4"><a href="ngs-sequence-analysis.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">cd</span> dada2_amplicon_ex_workflow/</span></code></pre></div>
<details>
<summary>
<strong>Q. Can you work out what each of these lines of code might be doing? - Click here for Answer</strong>
</summary>
<p><em>In brief these commmands:</em></p>
<p><em>- download/curl some external data</em>
<em>- uncompress into a folder</em>
<em>- remove the compressed file</em>
<em>- change the working directory to the newly created folder</em></p>
</details>
<p>In our working directory there are now 20 samples with one forward (R1) and one reverse (R2) read each, each file has DNA sequences with per-base-call quality information, for a total of 40 fastq files (.fq). It is a good idea to have a file with all the sample names to use for various things throughout, so here’s making that file based on how these sample names are formatted.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="ngs-sequence-analysis.html#cb27-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ls</span> <span class="pp">*</span>_R1.fq <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span> <span class="st">&quot;_&quot;</span> <span class="op">&gt;</span> samples</span></code></pre></div>
<div id="fastq" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> FASTQ?</h3>
<p>FASTQ format is a text-based format for storing both a biological sequence (usually nucleotide sequence) and its corresponding quality scores. As each nucleotide in a <em>read</em> is sequenced, it is assigned a <em>Phred quality score</em>. This score is the assigned <em>probability</em> of the sequencer having made an incorrect base call</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;font-weight: bold;">
Phred Quality Score
</th>
<th style="text-align:left;font-weight: bold;">
Probability of incorrect base call
</th>
<th style="text-align:left;font-weight: bold;">
Base call accuracy
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
1 in 10
</td>
<td style="text-align:left;">
90%
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
1 in 100
</td>
<td style="text-align:left;">
99%
</td>
</tr>
<tr>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
1 in 1000
</td>
<td style="text-align:left;">
99.90%
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
1 in 10,000
</td>
<td style="text-align:left;">
99.99%
</td>
</tr>
<tr>
<td style="text-align:right;">
50
</td>
<td style="text-align:left;">
1 in 100,000
</td>
<td style="text-align:left;">
100.00%
</td>
</tr>
<tr>
<td style="text-align:right;">
60
</td>
<td style="text-align:left;">
1 in 1,000,000
</td>
<td style="text-align:left;">
100.00%
</td>
</tr>
</tbody>
</table>
<p>These quality scores are stored within the FASTQ files as ASCII characters</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-40"></span>
<img src="images/ascii.png" alt="Phred quality scores as ASCII characters" width="80%" />
<p class="caption">
Figure 3.2: Phred quality scores as ASCII characters
</p>
</div>
<p>This is all stored together as four simple lines of repeating text so that a FASTQ file containing a single sequence might look like this:</p>
<pre><code>@SEQ_ID
GATTTGGGGTTCAAAGCAGTATCGATCAAATAGTAAATCCATTTGTTCAACTCACAGTTT
+
!&#39;&#39;*((((***+))%%%++)(%%%%).1***-+*&#39;&#39;))**55CCF&gt;&gt;&gt;&gt;&gt;&gt;CCCCCCC65
</code></pre>
<p>A single FASTQ file may contain millions of sequencing reads. Let’s look at the first 40 lines of <em>one</em> of our FASTQ files. And check it looks like a standard format.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="ngs-sequence-analysis.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> <span class="at">-40</span> B1_sub_F1.fq</span></code></pre></div>
<details>
<summary>
<strong>Q. By eye, can you tell whether these few lines look to be of good quality? - Click here for Answer</strong>
</summary>
<p><em>The ASCII characters are repeated every fourth line, most of these reads appear to be G letters or close to this - indicating greater than 99.9% accuracy - pretty good. Very observant students might have noticed that the end of the reads appear to be of lower quality. More on this later</em></p>
</details>
</div>
</div>
<div id="the-pipeline" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> The Pipeline</h2>
<p>This is a very simple overview of the pipeline we will run, some of these steps (especially early ones - are applicable to lots of NGS applications), later on they become more specific to <em>our</em> data.</p>
<ul>
<li><p>Import the FASTQ files and demultiplex (this step was done for us)</p></li>
<li><p>Remove adapters and primers (these may be included with our reads, but they are not part of the <em>natural</em> DNA sequence)</p></li>
<li><p>Check FASTQ data quality and trim/filter reads accordingly</p></li>
<li><p>Dereplicate (collapse identical sequences and choose a representative)</p></li>
<li><p>Assign ASVs - decide if (non-identical) sequences are similar enough to be considered as from the same species</p></li>
<li><p>Join forward and reverse reads together</p></li>
<li><p>Assign ASVs to Taxonomies</p></li>
<li><p>Count the abundance of different ASVs</p></li>
<li><p>Export taxonomy file, ASV fasta sequence file and count file to R for analysis</p></li>
</ul>
</div>
<div id="removing-primers" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Removing Primers</h2>
<p>To start, we need to remove the primers from all of these (the primers used for this run are in the “primers.fa” file in our working directory), and here we’re going to use <code>cutadapt</code> to do that at the command line (“Terminal” tab).</p>
<p>First we need to install <code>cutadapt</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="ngs-sequence-analysis.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> pip install <span class="at">--user</span> <span class="at">--upgrade</span> cutadapt</span></code></pre></div>
<blockquote>
<p><strong>Note</strong></p>
<p>You will probably get a warning message about PATH. You can ignore this, what it means is that CUTADAPT has been installed in your home directory, in order to use it we need to specify the absolute path TO cutadapt when we call it. This is done for you in the next code box below.</p>
</blockquote>
<p>Cutadapt operates on one sample at at time, so we’re going to use a wonderful little bash <em>loop</em> to run it on all of our samples.</p>
<div id="loops" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Loops</h3>
<p>Loops are extremely powerful way of controlling iteration. We can specify that a line of code is repeated across multiple objects. In this example we use the <code>samples</code> file we made earlier as the list of files across which we want this function of removing primers to loop. These same lines will then repeat until all the specified iterations are complete.</p>
<p>We won’t break down exactly how this loop works - but they are used across all programming languages (including R) and you can check out the R4DS book for an introduction to building your own loops (and custom functions!) <a href="https://r4ds.had.co.nz/iteration.html">here</a>.</p>
<p>For now just copy and paste this code exactly into the Terminal.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="ngs-sequence-analysis.html#cb31-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sample <span class="kw">in</span> <span class="va">$(</span><span class="fu">cat</span> samples<span class="va">)</span></span>
<span id="cb31-2"><a href="ngs-sequence-analysis.html#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">do</span></span>
<span id="cb31-3"><a href="ngs-sequence-analysis.html#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="ngs-sequence-analysis.html#cb31-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;On sample: </span><span class="va">$sample</span><span class="st">&quot;</span></span>
<span id="cb31-5"><a href="ngs-sequence-analysis.html#cb31-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-6"><a href="ngs-sequence-analysis.html#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">~/.local/bin/cutadapt</span> <span class="at">-a</span> ^GTGCCAGCMGCCGCGGTAA...ATTAGAWACCCBDGTAGTCC <span class="dt">\</span></span>
<span id="cb31-7"><a href="ngs-sequence-analysis.html#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">-A</span> ^GGACTACHVGGGTWTCTAAT...TTACCGCGGCKGCTGGCAC <span class="dt">\</span></span>
<span id="cb31-8"><a href="ngs-sequence-analysis.html#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">-m</span> 215 <span class="at">-M</span> 285 <span class="at">--discard-untrimmed</span> <span class="dt">\</span></span>
<span id="cb31-9"><a href="ngs-sequence-analysis.html#cb31-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">-o</span> <span class="va">${sample}</span>_sub_R1_trimmed.fq.gz <span class="at">-p</span> <span class="va">${sample}</span>_sub_R2_trimmed.fq.gz <span class="dt">\</span></span>
<span id="cb31-10"><a href="ngs-sequence-analysis.html#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">${sample}</span>_sub_R1.fq <span class="va">${sample}</span>_sub_R2.fq <span class="dt">\</span></span>
<span id="cb31-11"><a href="ngs-sequence-analysis.html#cb31-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> cutadapt_primer_trimming_stats.txt <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb31-12"><a href="ngs-sequence-analysis.html#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="ngs-sequence-analysis.html#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span></code></pre></div>
<p>Here’s a before-and-after of one of our files - if you look at the sequences supplied: GTGCCAGCMGCCGCGGTAA…ATTAGAWACCCBDGTAGTCC these indicate the forward primer and the reverse primer (our amplicon is everything inbetween). If you look at our before and after you should see these were at the start and end of the sequence but have now been trimmed off.</p>
<pre><code>### R1 BEFORE TRIMMING PRIMERS
head -n 2 B1_sub_R1.fq
# @M02542:42:000000000-ABVHU:1:1101:8823:2303 1:N:0:3
# GTGCCAGCAGCCGCGGTAATACGTAGGGTGCGAGCGTTAATCGGAATTACTGGGCGTAAAGCGTGCGCAGGCGGTCTTGT
# AAGACAGAGGTGAAATCCCTGGGCTCAACCTAGGAATGGCCTTTGTGACTGCAAGGCTGGAGTGCGGCAGAGGGGGATGG
# AATTCCGCGTGTAGCAGTGAAATGCGTAGATATGCGGAGGAACACCGATGGCGAAGGCAGTCCCCTGGGCCTGCACTGAC
# GCTCATGCACGAAAGCGTGGGGAGCAAACAGGATTAGATACCCGGGTAGTCC

### R1 AFTER TRIMMING PRIMERS
head -n 2 B1_sub_R1_trimmed.fq
# @M02542:42:000000000-ABVHU:1:1101:8823:2303 1:N:0:3
# TACGTAGGGTGCGAGCGTTAATCGGAATTACTGGGCGTAAAGCGTGCGCAGGCGGTCTTGTAAGACAGAGGTGAAATCCC
# TGGGCTCAACCTAGGAATGGCCTTTGTGACTGCAAGGCTGGAGTGCGGCAGAGGGGGATGGAATTCCGCGTGTAGCAGTG
# AAATGCGTAGATATGCGGAGGAACACCGATGGCGAAGGCAGTCCCCTGGGCCTGCACTGACGCTCATGCACGAAAGCGTG
# GGGAGCAAACAGG</code></pre>
<p>You can look through the output of the cutadapt stats file we made (“cutadapt_primer_trimming_stats.txt”) to get an idea of how things went.</p>
<p>Here’s a little one-liner to look at what fraction of reads were retained in each sample (column 2) and what fraction of bps were retained in each sample (column 3):</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="ngs-sequence-analysis.html#cb33-1" aria-hidden="true" tabindex="-1"></a>    <span class="ex">paste</span> samples <span class="op">&lt;(</span><span class="fu">grep</span> <span class="st">&quot;passing&quot;</span> cutadapt_primer_trimming_stats.txt <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f3</span> <span class="at">-d</span> <span class="st">&quot;(&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&quot;)&quot;</span><span class="op">)</span> <span class="op">&lt;(</span><span class="fu">grep</span> <span class="st">&quot;filtered&quot;</span> cutadapt_primer_trimming_stats.txt <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f3</span> <span class="at">-d</span> <span class="st">&quot;(&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="at">-d</span> <span class="st">&quot;)&quot;</span><span class="op">)</span></span></code></pre></div>
<pre><code># B1    96.5%   83.0%
# B2    96.6%   83.3%
# B3    95.4%   82.4%
# B4    96.8%   83.4%
# BW1   96.4%   83.0%
# BW2   94.6%   81.6%
# R10   92.4%   79.8%
# R11BF 90.6%   78.2%
# R11   93.3%   80.6%
# R12   94.3%   81.4%
# R1A   93.3%   80.5%
# R1B   94.0%   81.1%
# R2    94.0%   81.2%
# R3    93.8%   81.0%
# R4    95.5%   82.4%
# R5    93.7%   80.9%
# R6    92.7%   80.1%
# R7    94.4%   81.5%
# R8    93.2%   80.4%
# R9    92.4%   79.7%</code></pre>
<p>This looks like it worked pretty well!
Some reads were discarded entirely <code>-m 215 -M 285 --discard-untrimmed \</code> anything &lt;215bp or &gt;285bp was discarded. Looks like c. 6-8%
We lost a greater proportion of bp overall, but this is the program working as it should, making most of our reads a little shorter as it cuts off the primers. Overall it looks like we lost c.20% of bp.</p>
<p>Importantly all of our files have behaved <em>roughly</em> the same.</p>
<p>With primers removed, we’re now ready to switch R and start using DADA2!</p>
</div>
</div>
<div id="dada2" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> DADA2</h2>
<div class="rmdwarning">
<p>
Switch from the Terminal to Console now. We are working in R for the rest of this workflow
</p>
</div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="ngs-sequence-analysis.html#cb35-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(dada2)</span>
<span id="cb35-2"><a href="ngs-sequence-analysis.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="ngs-sequence-analysis.html#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setwd</span>(<span class="st">&quot;dada2_amplicon_ex_workflow&quot;</span>)</span>
<span id="cb35-4"><a href="ngs-sequence-analysis.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="ngs-sequence-analysis.html#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list.files</span>() <span class="co"># make sure what we think is here is actually here</span></span>
<span id="cb35-6"><a href="ngs-sequence-analysis.html#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="ngs-sequence-analysis.html#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="do">## first we&#39;re setting a few R objects we&#39;re going to use ##</span></span>
<span id="cb35-8"><a href="ngs-sequence-analysis.html#cb35-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># one with all sample names, by scanning our &quot;samples&quot; file we made earlier</span></span>
<span id="cb35-9"><a href="ngs-sequence-analysis.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">&quot;samples&quot;</span>, <span class="at">what=</span><span class="st">&quot;character&quot;</span>)</span>
<span id="cb35-10"><a href="ngs-sequence-analysis.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="ngs-sequence-analysis.html#cb35-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># one holding the file names of all the forward reads</span></span>
<span id="cb35-12"><a href="ngs-sequence-analysis.html#cb35-12" aria-hidden="true" tabindex="-1"></a>  forward_reads <span class="ot">&lt;-</span> <span class="fu">paste0</span>(samples, <span class="st">&quot;_sub_R1_trimmed.fq.gz&quot;</span>)</span>
<span id="cb35-13"><a href="ngs-sequence-analysis.html#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="ngs-sequence-analysis.html#cb35-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and one with the reverse</span></span>
<span id="cb35-15"><a href="ngs-sequence-analysis.html#cb35-15" aria-hidden="true" tabindex="-1"></a>  reverse_reads <span class="ot">&lt;-</span> <span class="fu">paste0</span>(samples, <span class="st">&quot;_sub_R2_trimmed.fq.gz&quot;</span>)</span>
<span id="cb35-16"><a href="ngs-sequence-analysis.html#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="ngs-sequence-analysis.html#cb35-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and variables holding file names for the forward and reverse</span></span>
<span id="cb35-18"><a href="ngs-sequence-analysis.html#cb35-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># filtered reads we&#39;re going to generate below</span></span>
<span id="cb35-19"><a href="ngs-sequence-analysis.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  filtered_forward_reads <span class="ot">&lt;-</span> <span class="fu">paste0</span>(samples, <span class="st">&quot;_sub_R1_filtered.fq.gz&quot;</span>)</span>
<span id="cb35-20"><a href="ngs-sequence-analysis.html#cb35-20" aria-hidden="true" tabindex="-1"></a>  filtered_reverse_reads <span class="ot">&lt;-</span> <span class="fu">paste0</span>(samples, <span class="st">&quot;_sub_R2_filtered.fq.gz&quot;</span>)</span></code></pre></div>
</div>
<div id="quality-trimmingfiltering" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Quality trimming/filtering</h2>
<p>We did a filtering step above with cutadapt (where we eliminated reads that had imperfect or missing primers and those that were shorter than 215 bps or longer than 285), but in DADA2 we’ll implement a trimming step as well (where we trim reads down based on some quality threshold rather than throwing the read away).</p>
<p>Since we’re potentially shortening reads further, we’re again going to include another minimum-length filtering component. We can also take advantage of a handy quality plotting function that DADA2 provides to visualize how you’re reads are doing, plotQualityProfile().</p>
<p>By running that on our variables that hold all of our forward and reverse read filenames, we can easily generate plots for all samples or for a subset of them. So let’s take a peak at that to help decide our trimming lengths: It’s good to try to keep a bird’s-eye view of what’s going on. So here is an overview of the main processing steps we’ll be performing with cutadapt and DADA2. Don’t worry if anything seems unclear right now, we will discuss each at each step.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="ngs-sequence-analysis.html#cb36-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotQualityProfile</span>(forward_reads[<span class="dv">17</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb36-2"><a href="ngs-sequence-analysis.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="ngs-sequence-analysis.html#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotQualityProfile</span>(reverse_reads[<span class="dv">17</span><span class="sc">:</span><span class="dv">20</span>])</span></code></pre></div>
<p>All forwards look pretty similar to each other, and all reverses look pretty similar to each other, but worse than the forwards, which is common –
the Illumina sequencer reads all of the molecules in the forward orientation <em>first</em>, then the clusters are flipped and read in reverse. But this means a lot of the chemical reagents start to get used up or degraded, so it is usual to get lower quality reverse reads.</p>
<p>On the plots produced</p>
<ul>
<li><p>the x axis is the nucleotide bases starting from the beginning of the read moving to the end</p></li>
<li><p>the y axis is the average quality score for the base in that position</p></li>
<li><p>the green line is the median quality score of the base at that position</p></li>
<li><p>the orange lines are quartiles</p></li>
</ul>
<p>These quality profiles are based entirely on taking the <em>average</em> PHRED scores for sequences at that position in the sample</p>
<p>Here, I’m going to cut the forward reads at 250 and the reverse reads at 200 – roughly where both sets maintain a median quality of 30 or above – and then see how things look. But we also want to set a minimum length to filter out truncated sequences, so we will set a minimum acceptable read length of 175bp (any reads shorter than this will be discarded).</p>
<p>In DADA2, this quality-filtering step is done with the <code>filterAndTrim()</code> function:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="ngs-sequence-analysis.html#cb37-1" aria-hidden="true" tabindex="-1"></a>    filtered_out <span class="ot">&lt;-</span> <span class="fu">filterAndTrim</span>(forward_reads, filtered_forward_reads,</span>
<span id="cb37-2"><a href="ngs-sequence-analysis.html#cb37-2" aria-hidden="true" tabindex="-1"></a>                    reverse_reads, filtered_reverse_reads, <span class="at">maxEE=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb37-3"><a href="ngs-sequence-analysis.html#cb37-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">rm.phix=</span><span class="cn">TRUE</span>, <span class="at">minLen=</span><span class="dv">175</span>, <span class="at">truncLen=</span><span class="fu">c</span>(<span class="dv">250</span>,<span class="dv">200</span>))</span></code></pre></div>
<p>This function made a bunch of output files “filtered_forward_reads” and “filtered_reverse_reads” we can see these in our project pane. Or if we were working on a server without a GUI we could use <code>list.files()</code> in R or <code>ls</code> in our Terminal.</p>
<p>We also generated an R file called filtered_out. This is a simple matrix holding how many reads went <em>in</em> for each file and how many came <em>out</em>.</p>
<p>Check it in R.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="ngs-sequence-analysis.html#cb38-1" aria-hidden="true" tabindex="-1"></a>    filtered_out</span></code></pre></div>
<p>We can take a look at the filtered reads visually - we expect to have trimmed off that section where quality drops</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="ngs-sequence-analysis.html#cb39-1" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotQualityProfile</span>(filtered_reverse_reads[<span class="dv">17</span><span class="sc">:</span><span class="dv">20</span>])</span></code></pre></div>
<p>Looking Good!</p>
</div>
<div id="dereplication" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Dereplication</h2>
<p>Dereplication is a common step in many amplicon processing workflows. Instead of keeping 100 identical sequences and doing all downstream processing to all 100 -costing computer processing power and time, you can keep/process just one of them, and just attach the number x100 to it. Now this acts as a representative for 100 identical sequences.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="ngs-sequence-analysis.html#cb40-1" aria-hidden="true" tabindex="-1"></a>derep_forward <span class="ot">&lt;-</span> <span class="fu">derepFastq</span>(filtered_forward_reads, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span>
<span id="cb40-2"><a href="ngs-sequence-analysis.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(derep_forward) <span class="ot">&lt;-</span> samples <span class="co"># the sample names in these objects are initially the file names of the samples, this sets them to the sample names for the rest of the workflow</span></span>
<span id="cb40-3"><a href="ngs-sequence-analysis.html#cb40-3" aria-hidden="true" tabindex="-1"></a>derep_reverse <span class="ot">&lt;-</span> <span class="fu">derepFastq</span>(filtered_reverse_reads, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span>
<span id="cb40-4"><a href="ngs-sequence-analysis.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(derep_reverse) <span class="ot">&lt;-</span> samples</span></code></pre></div>
</div>
<div id="asvs" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> ASV’s</h2>
<p>This is where we start to take our raw sequence data and infer <em>true</em> biological sequences.
It uses an algorithm to look at the consensus quality score and abundance for each <em>unique</em> sequence. It then determines whether this sequence is more likely to be of biological origin or a spurious sequencing error.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>This step may take a few minutes to run, so be patient!</p>
</blockquote>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="ngs-sequence-analysis.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;amplicon_dada2_ex.RData&quot;</span>)</span>
<span id="cb41-2"><a href="ngs-sequence-analysis.html#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="ngs-sequence-analysis.html#cb41-3" aria-hidden="true" tabindex="-1"></a>dada_forward <span class="ot">&lt;-</span> <span class="fu">dada</span>(derep_forward, <span class="at">err=</span>err_forward_reads, <span class="at">pool=</span><span class="st">&quot;pseudo&quot;</span>)</span>
<span id="cb41-4"><a href="ngs-sequence-analysis.html#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="ngs-sequence-analysis.html#cb41-5" aria-hidden="true" tabindex="-1"></a>dada_reverse <span class="ot">&lt;-</span> <span class="fu">dada</span>(derep_reverse, <span class="at">err=</span>err_reverse_reads, <span class="at">pool=</span><span class="st">&quot;pseudo&quot;</span>)</span></code></pre></div>
</div>
<div id="merging-reads" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Merging reads</h2>
<p>Now DADA2 merges the forward and reverse ASVs to reconstruct our full target amplicon requiring the overlapping region to be identical between the two. By default it requires that at least 12 bps overlap, but in our case the overlap should be much greater. If you remember above we trimmed the forward reads to 250 and the reverse to 200, and our primers were 515f–806r. After cutting off the primers we’re expecting a typical amplicon size of around 260 bases, so our typical overlap should be up around 190. That’s estimated based on E. coli 16S rRNA gene positions and very back-of-the-envelope-esque of course, so to allow for true biological variation and such I’m going ot set the minimum overlap for this dataset for 170. I’m also setting the trimOverhang option to TRUE in case any of our reads go passed their opposite primers (which I wouldn’t expect based on our trimming, but is possible due to the region and sequencing method).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="ngs-sequence-analysis.html#cb42-1" aria-hidden="true" tabindex="-1"></a>merged_amplicons <span class="ot">&lt;-</span> <span class="fu">mergePairs</span>(dada_forward, derep_forward, dada_reverse,</span>
<span id="cb42-2"><a href="ngs-sequence-analysis.html#cb42-2" aria-hidden="true" tabindex="-1"></a>                    derep_reverse, <span class="at">trimOverhang=</span><span class="cn">TRUE</span>, <span class="at">minOverlap=</span><span class="dv">170</span>)</span>
<span id="cb42-3"><a href="ngs-sequence-analysis.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="ngs-sequence-analysis.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this object holds a lot of information that may be the first place you&#39;d want to look if you want to start poking under the hood</span></span>
<span id="cb42-5"><a href="ngs-sequence-analysis.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(merged_amplicons) <span class="co"># list</span></span>
<span id="cb42-6"><a href="ngs-sequence-analysis.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(merged_amplicons) <span class="co"># 20 elements in this list, one for each of our samples</span></span>
<span id="cb42-7"><a href="ngs-sequence-analysis.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(merged_amplicons) <span class="co"># the names() function gives us the name of each element of the list </span></span>
<span id="cb42-8"><a href="ngs-sequence-analysis.html#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="ngs-sequence-analysis.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(merged_amplicons<span class="sc">$</span>B1) <span class="co"># each element of the list is a dataframe that can be accessed and manipulated like any ordinary dataframe</span></span>
<span id="cb42-10"><a href="ngs-sequence-analysis.html#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="ngs-sequence-analysis.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(merged_amplicons<span class="sc">$</span>B1) <span class="co"># the names() function on a dataframe gives you the column names</span></span>
<span id="cb42-12"><a href="ngs-sequence-analysis.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;sequence&quot;  &quot;abundance&quot; &quot;forward&quot;   &quot;reverse&quot;   &quot;nmatch&quot;    &quot;nmismatch&quot; &quot;nindel&quot;    &quot;prefer&quot;    &quot;accept&quot;</span></span></code></pre></div>
</div>
<div id="count-table" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Count table</h2>
<p>Now we can generate a count table with the makeSequenceTable() function. This is one of the main outputs from processing an amplicon dataset. You may have also heard this referred to as a biome table, or an OTU matrix.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="ngs-sequence-analysis.html#cb43-1" aria-hidden="true" tabindex="-1"></a>seqtab <span class="ot">&lt;-</span> <span class="fu">makeSequenceTable</span>(merged_amplicons)</span>
<span id="cb43-2"><a href="ngs-sequence-analysis.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(seqtab) <span class="co"># matrix</span></span>
<span id="cb43-3"><a href="ngs-sequence-analysis.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(seqtab) <span class="co"># 20 2521</span></span></code></pre></div>
</div>
<div id="overview" class="section level2" number="3.12">
<h2><span class="header-section-number">3.12</span> Overview</h2>
<p>The developers’ DADA2 tutorial provides an example of a nice, quick way to pull out how many reads were dropped at various points of the pipeline. This can serve as a jumping off point if you’re left with too few sequences at the end to help point you towards where you should start digging into where they are being dropped. Here’s a slightly modified version:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="ngs-sequence-analysis.html#cb44-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set a little function</span></span>
<span id="cb44-2"><a href="ngs-sequence-analysis.html#cb44-2" aria-hidden="true" tabindex="-1"></a>getN <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">getUniques</span>(x))</span>
<span id="cb44-3"><a href="ngs-sequence-analysis.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="ngs-sequence-analysis.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># making a little table</span></span>
<span id="cb44-5"><a href="ngs-sequence-analysis.html#cb44-5" aria-hidden="true" tabindex="-1"></a>summary_tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row.names=</span>samples, <span class="at">dada2_input=</span>filtered_out[,<span class="dv">1</span>],</span>
<span id="cb44-6"><a href="ngs-sequence-analysis.html#cb44-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">filtered=</span>filtered_out[,<span class="dv">2</span>], <span class="at">dada_f=</span><span class="fu">sapply</span>(dada_forward, getN),</span>
<span id="cb44-7"><a href="ngs-sequence-analysis.html#cb44-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">dada_r=</span><span class="fu">sapply</span>(dada_reverse, getN), <span class="at">merged=</span><span class="fu">sapply</span>(merged_amplicons, getN),</span>
<span id="cb44-8"><a href="ngs-sequence-analysis.html#cb44-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">nonchim=</span><span class="fu">rowSums</span>(seqtab.nochim),</span>
<span id="cb44-9"><a href="ngs-sequence-analysis.html#cb44-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">final_perc_reads_retained=</span><span class="fu">round</span>(<span class="fu">rowSums</span>(seqtab.nochim)<span class="sc">/</span>filtered_out[,<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb44-10"><a href="ngs-sequence-analysis.html#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="ngs-sequence-analysis.html#cb44-11" aria-hidden="true" tabindex="-1"></a>summary_tab</span></code></pre></div>
<p>And it might be useful to write this table out of R, saving it as a regular file</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="ngs-sequence-analysis.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(summary_tab, <span class="st">&quot;read-count-tracking.tsv&quot;</span>, <span class="at">quote=</span><span class="cn">FALSE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names=</span><span class="cn">NA</span>)</span></code></pre></div>
</div>
<div id="assign-taxonomy" class="section level2" number="3.13">
<h2><span class="header-section-number">3.13</span> Assign taxonomy</h2>
<div class="rmdwarning">
<p>
Running the Taxonomy assignment step below can take anywhere from 30 minutes to a few hours depending on how much RAM we provide. So for this example run - we will skip this step and load an R.data file which has this information in it already
</p>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="ngs-sequence-analysis.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;amplicon_dada2_ex.RData&quot;</span>)</span></code></pre></div>
<details>
<summary>
<strong>Example code for running taxonomy assignment - Click here</strong>
</summary>
<p><em>So we won’t run this code in this example, but here it is for reference.</em></p>
<pre><code>## downloading DECIPHER-formatted SILVA v138 reference
download.file(url=&quot;http://www2.decipher.codes/Classification/TrainingSets/SILVA_SSU_r138_2019.RData&quot;, destfile=&quot;SILVA_SSU_r138_2019.RData&quot;)

## loading reference taxonomy object
load(&quot;SILVA_SSU_r138_2019.RData&quot;)

## loading DECIPHER
library(DECIPHER)

## creating DNAStringSet object of our ASVs
dna &lt;- DNAStringSet(getSequences(seqtab.nochim))

## and classifying
tax_info &lt;- IdTaxa(test=dna, trainingSet=trainingSet, strand=&quot;both&quot;, processors=NULL)</code></pre>
</details>
</div>
<div id="standard-goods" class="section level2" number="3.14">
<h2><span class="header-section-number">3.14</span> Standard goods</h2>
<p>The typical standard outputs from amplicon processing are</p>
<ul>
<li><p>a fasta file: each ASV represented by a sequence <code>asv_fasta_no_contam</code></p></li>
<li><p>a count table: how many sequences of each ASV in each sample <code>asv_tab_no_contam</code></p></li>
<li><p>a taxonomy file: the closest biological species to the fasta sequence <code>asv_tax_no_contam</code></p></li>
</ul>
<p>These objects from DADA2 can then be analysed to start to understand the different bacterial communities from our deep-sea study:</p>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li>These three files are relatively small simply lists now, you can type them into the R console and inspect these outputs if you wish. Do they make sense to you?</li>
</ul>
</blockquote>
</div>
<div id="functions-list" class="section level2" number="3.15">
<h2><span class="header-section-number">3.15</span> Functions list</h2>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;">
Command
</th>
<th style="text-align:left;font-weight: bold;">
What it is
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
cutadapt/filterAndTrim()
</td>
<td style="text-align:left;">
remove primers and quality trim/filter
</td>
</tr>
<tr>
<td style="text-align:left;">
learnErrors()
</td>
<td style="text-align:left;">
generate an error model of our data
</td>
</tr>
<tr>
<td style="text-align:left;">
derepFastq
</td>
<td style="text-align:left;">
dereplicate sequences
</td>
</tr>
<tr>
<td style="text-align:left;">
dada()
</td>
<td style="text-align:left;">
infer ASVs on both forward and reverse reads independently
</td>
</tr>
<tr>
<td style="text-align:left;">
mergePairs()
</td>
<td style="text-align:left;">
merge forward and reverse reads to further refine ASVs
</td>
</tr>
<tr>
<td style="text-align:left;">
makeSequenceTable()
</td>
<td style="text-align:left;">
generate a count table
</td>
</tr>
<tr>
<td style="text-align:left;">
removeBimeraDenovo()
</td>
<td style="text-align:left;">
screen for and remove chimeras
</td>
</tr>
<tr>
<td style="text-align:left;">
IdTaxa()
</td>
<td style="text-align:left;">
assign taxonomy
</td>
</tr>
</tbody>
</table>
</div>
<div id="summary-2" class="section level2" number="3.16">
<h2><span class="header-section-number">3.16</span> Summary</h2>
<p>We have imported FASTQ data from an Illumina sequencing run, processed the files to remove poor quality reads and trim primers. We have then put this through a microbiome specific bioinformatics pipeline to assign millions of individual reads to more manageable representative sequences. We have assigned taxonomies to these sequences and tallied them, so that <strong>next time</strong> we can actually inspect our data and start to make visuals that describe our microbial communities.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Unix.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-statistical-analysis-of-the-microbiome-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-literature.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
